{% extends 'base/admin.html' %}
{% load static %}
{% block title %}
  Admin Discussion Management
{% endblock %}
{% block stylesheet %}
  <link rel="stylesheet" href="{% static 'style/admin.css/admin.commodities.css' %}" />
{% endblock %}

{% block content %}
  <br />
  <div class="main-content" id="main-content">
    <div class="container">
      <h3 style="font-weight:bold;">ADMIN DISCUSSION MANAGEMENT</h3>
      <hr style="color: black;" />
      <div class="card-container">
        <div class="animated fadeIn">
          <div class="row">
            <div class="col-lg-3 col-md-6">
              <div class="card">
                <div class="card-body">
                  <div class="stat-widget-five">
                    <div class="stat-icon dib flat-color-cmi">
                      <span class="mdi mdi-note-plus"></span>
                    </div>
                    <div class="stat-content">
                      <div class="text-left dib">
                        <div class="stat-text">
                          <span class="count">
                            {% if total_posts_today %}
                              {{ total_posts_today }}
                            {% else %}
                              0
                            {% endif %}
                          </span>
                        </div>
                        <div class="stat-heading">
                          <span>Daily Posts</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-lg-3 col-md-6">
              <div class="card">
                <div class="card-body">
                  <div class="stat-widget-five">
                    <div class="stat-icon dib flat-color-1">
                      <span class="mdi mdi-post"></span>
                    </div>
                    <div class="stat-content">
                      <div class="text-left dib">
                        <div class="stat-text">
                          <span class="count">
                            {% if total_discussions %}
                              {{ total_discussions }}
                            {% else %}
                              0
                            {% endif %}
                          </span>
                        </div>
                        <div class="stat-heading">
                          <span>Total Posts</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <br />
      <div class="button-container-head">
        <a href="{% url 'admin-search' %}" id="approved-data-button" style="background-color: #0C356A; color: #fff; border: 0; border-radius: 3px; padding: 5px; font-weight: bold;">Search Analytics</a>
        <a href="{% url 'admin-reaction' %}" id="approved-data-button" style="background-color: #0C356A; color: #fff; border: 0; border-radius: 3px; padding: 5px; font-weight: bold;">Reactions Analytics</a>
        <a href="{% url 'admin-comment' %}" id="approved-data-button" style="background-color: #0C356A; color: #fff; border: 0; border-radius: 3px; padding: 5px; font-weight: bold;">Comments Analytics</a>
      </div>
      <hr />
      <div class="table-container">
        <table id="discussionTable" class="discussion-table table table-bordered">
          <thead style="color: #fff; font-size: 13px; background-color: #0C356A; font-weight: bolder;">
            <tr>
              <th>ID</th>
              <th>Title</th>
              <th>Question</th>
              <th>Tagged Commodity</th>
              <th>Date</th>
              <th>Likes</th>
              <th>Dislikes</th>
              <th>Comments</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody style="font-size: 12px;">
            {% for forum in forums %}
              <tr>
                <td>{{ forum.discussion_id }}</td>
                <td>{{ forum.discussion_title }}</td>
                <td>{{ forum.discussion_question }}</td>
                <td>
                  {% for commodity in forum.commodity_id.all %}
                    <span style="background-color: #0C356A; color: white;">{{ commodity.commodity_name }}</span>
                  {% endfor %}
                </td>
                <td>{{ forum.date_posted }}</td>
                <td>
                  {% if forum.reaction_set.exists %}
                    {% for reaction in forum.reaction_set.all %}
                      {{ reaction.like }}
                    {% endfor %}
                  {% else %}
                    0
                  {% endif %}
                </td>
                <td>
                  {% if forum.reaction_set.exists %}
                    {% for reaction in forum.reaction_set.all %}
                      {{ reaction.dislike }}
                    {% endfor %}
                  {% else %}
                    0
                  {% endif %}
                </td>
                <td>{{ forum.comment_set.count }}</td>
                <td>
                  <a data-placement="top" data-toggle="tooltip" title="delete" href="/delete-discussion/{{ forum.discussion_id }}" class="btn btn-danger btn-sm"><i class="fa-solid fa-trash"></i></a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endblock %}

{% block script %}
  <script>
    $(document).ready(function () {
      let table = $('#discussionTable').DataTable({
        language: {
          lengthMenu: '_MENU_',
          search: '',
          searchPlaceholder: 'Search...'
        },
        lengthMenu: [
          [3, 5, 7, 10, 25, -1],
          [3, 5, 7, 10, 25, 'All']
        ],
        paging: true,
        lengthChange: true,
        autoWidth: false,
        bInfo: true,
        bSort: true,
        responsive: true,
        buttons: [
          {
            text: 'CSV',
            extend: 'csv'
          },
          {
            text: 'PDF',
            extend: 'pdf'
          }
        ],
        dom: '<"row"<"col-md-1"l><"col-md-8"B><"col-md-3"f>>' + '<"row"<"col-md-12"tr>>' + '<"row"<"col-md-5"i><"col-md-7"p>>'
      })
    })
  </script>
  {% if messages %}
    {% for message in messages %}
      {% if message.tags == 'success' %}
        <script>
          // Display SweetAlert success message
          Swal.fire({
            icon: 'success',
            title: 'Success!',
            text: '{{ message }}'
          })
        </script>
        {% else %}
        <script>
          // Display SweetAlert success message
          Swal.fire({
            icon: 'error',
            title: 'Error!',
            text: '{{ message }}'
          })
        </script>
      {% endif %}
    {% endfor %}
  {% endif %}
{% endblock %}
